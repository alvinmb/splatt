<!DOCTYPE html>
<html>
<head>
    <title>Webcam Brightest Point Finder</title>
    <script async src="https://docs.opencv.org/master/opencv.js" type="text/javascript"></script>
</head>
<body>
    <video id="videoInput" playsinline autoplay></video>
    <canvas id="canvasOutput"></canvas>
        <script>
            let video = document.getElementById('videoInput');
            let canvas = document.getElementById('canvasOutput');
            let context = canvas.getContext('2d');
    
            navigator.mediaDevices.getUserMedia({ video: true, audio: false })
                .then(function(stream) {
                    video.srcObject = stream;
                    video.play();
                })
                .catch(function(err) {
                    console.log("An error occurred: " + err);
                });
    
            video.addEventListener('play', function() {
                function processFrame() {
                    if (video.paused || video.ended) {
                        return;
                    }
                    context.drawImage(video, 0, 0, canvas.width, canvas.height);
                    let src = cv.imread('canvasOutput');
                    let gray = new cv.Mat();
                    cv.cvtColor(src, gray, cv.COLOR_RGBA2GRAY, 0);
                    
                    // Apply Gaussian Blur
                    let blurred = new cv.Mat();
                    let ksize = new cv.Size(11, 11);
                    cv.GaussianBlur(gray, blurred, ksize, 0, 0, cv.BORDER_DEFAULT);
                    
                    result = cv.minMaxLoc(blurred,  new cv.Mat());
                    let radius = 10;
                    let color = new cv.Scalar(255, 0, 0, 255);
                    cv.circle(src, result.maxLoc, radius, color, 1);
                    cv.imshow('canvasOutput', src);
                    src.delete(); gray.delete(); blurred.delete(); 
                    requestAnimationFrame(processFrame);
                }
                requestAnimationFrame(processFrame);
            });
        </script>
</body>
</html>